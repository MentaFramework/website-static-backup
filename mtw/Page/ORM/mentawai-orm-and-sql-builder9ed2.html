<!-- MWF Site -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

 



<html>

<!-- Mirrored from mentaframework.org/mtw/Page/ORM/mentawai-orm-and-sql-builder?lang=en by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 11 Jan 2022 15:48:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>

<title>Mentawai - ORM and SQL Builder</title>

<style type="text/css" media="all">
@import url("../../../Page.getCSSb6bf.css?file=main.css");
</style>

<meta http-equiv="imagetoolbar" content="no" />
<meta http-equiv="imagetoolbar" content="false" />

<link rel="shortcut icon" type="image/x-icon" href="../../../images/menta-ico.ico" />
<link rel="icon" type="image/png" href="../../../images/menta-ico.png" />
<link rel="stylesheet" href="../../../Page.getPrintCSSc26f.css?file=print.css" type="text/css" media="print" />

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="author" content="Sergio Oliveira Junior" />
<meta name="email" content="sergio.oliveira.jr@gmail.com" />

<link href="../../../css/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../../jquery/jquery-1.6.4.min.js"></script>
<script src="../../../js/jquery-ui-1.8.16.custom.min.js"></script>

<link href="../../../uploadify/uploadify.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="../../../uploadify/swfobject.js"></script>
<script type="text/javascript" src="../../../uploadify/jquery.uploadify.v2.1.4.min.js"></script>

<!-- Include required JS files -->
<script type="text/javascript" src="../../../sh/js/shCore.js"></script>
 
<!--
    At least one brush, here we choose JS. You need to include a brush for every 
    language you want to highlight
-->
<script type="text/javascript" src="../../../sh/js/shBrushJava.js"></script>
<script type="text/javascript" src="../../../sh/js/shBrushXml.js"></script>
<script type="text/javascript" src="../../../sh/js/shBrushRuby.js"></script>
 
<!-- Include *at least* the core style and default theme -->
<link href="../../../sh/css/shCore.css" rel="stylesheet" type="text/css" />
<link href="../../../sh/css/shThemeDefault.css" rel="stylesheet" type="text/css" />
 
<!-- Finally, to actually run the highlighter, you need to include this JS on your page -->
<script type="text/javascript">
     SyntaxHighlighter.all();
</script>

<!--  User JavaScript -->
<script type="text/javascript">

function myJavaScriptFunction {

   // put something here!!!!

}


</script>


<script language="JavaScript">
    
        $(document).ready(function() {
        
        	

            
			
			

            

			$('#loginDialog').keyup(function(e) {
    			if (e.keyCode == 13) {
        			$('#loginForm').submit();
    			}
			});
			
			$('#file_upload').uploadify({
				'uploader'  : '/uploadify/uploadify.swf',
				'script'    : '/File.upload.mtw;jsessionid=6AD72DCDAECF4742DE76FB1CBFB4B484',
				'cancelImg' : '/uploadify/cancel.png',
				'folder'    : '/uploads',
				'scriptData': { 'JSESSIONID': '6AD72DCDAECF4742DE76FB1CBFB4B484'},
				'auto'      : true,
				'multi'     : true,
				'onComplete'  : function(event, ID, fileObj, response, data) {

					var resp = eval('(' + response + ')');
		
					if (resp.status == 'success') {
						$('#uploadResults').append('<tr><td style="color: blue;">' + resp.msg + '</td></tr>');
					} else if (resp.status == 'error') {
						$('#uploadResults').append('<tr><td style="color: red;">' + resp.msg + '</td></tr>');    				
					}
				}
			});

            // ajax add new user:

	        
            $('#usernameLoading').hide();
    
            $('#addNewUserUsername').blur( function() {
    
                $('#usernameMessage').hide();
    
                if ($('#addNewUserUsername').val().trim() != '') {

                    $('#usernameLoading').show();
    
                    $.post("/User.check.mtw", {
                        username : $('#addNewUserUsername').val()
                    }, function(response) {
                        $('#usernameMessage').fadeOut();
                        setTimeout("usernameResult('"
                                + escape(response) + "')", 400);
                    });
                }
    
                return false;
            });

        });
        
        function prepareEditPageDialog(myDialog, theTitle) {

            options = {
                autoOpen: false,
                width: 1000,
                modal: true,
                title: theTitle,
                buttons: [
                          {
                                text: "Save",
                                click: function() { $('#editPageForm').submit(); }
                          },
                          {
                                text: "Preview",
                                click: function() { $('#editPagePreview').val('true'); $('#editPageForm').submit(); }
                          },                          
                          {
                                text: "Cancel",
                                click: function() { $(this).dialog("close"); }
                          }
                      ]
           };

          myDialog.dialog(options);

          return myDialog;
        }

        function prepareShowPageDialog(myDialog, theTitle) {

            options = {
                autoOpen: false,
                width: 800,
                modal: true,
                title: theTitle,
                buttons: [
                          {
                                text: "Back",
                                click: function() { $(this).dialog("close"); }
                          },
                          {
                                text: "Close",
                                click: function() { $(this).dialog("close"); $('#listLastRevisionsDialog').dialog('close'); $('#listRevisionsDialog').dialog('close'); $('#listAllPagesDialog').dialog('close'); }
                          }
                      ]
           };

          myDialog.dialog(options);

          return myDialog;
        }
        
		function prepareFileListDialog(myDialog) {

            options = {
                autoOpen: false,
                width: 400,
                height: 300,
                modal: true,
                title: "Files uploaded:",
                buttons: [
                          {
                                text: "Close",
                                click: function() { $(this).dialog("close"); }
                          }
                      ]
           };

          myDialog.dialog(options);

          return myDialog;
        }        
                

        function prepareListAllPagesDialog(myDialog, showEdit) {

            listAllPagesButtons = [
                      {
                            text: "Close",
                            click: function() { $(this).dialog("close"); }
                      }];

            if (showEdit) {
                listAllPagesButtons = [
                          {
                                text: "FrontPage",
                                click: function() { $('#listAllPagesForm').attr('action', '/Page.setFrontPage.mtw'); $('#listAllPagesForm').submit(); }
                          },
                          {
                                text: "Delete",
                                click: function() { $('#listAllPagesForm').attr('action', '/Page.delete.mtw'); $('#listAllPagesForm').submit(); }
                          },
                          {
                                text: "Close",
                                click: function() { $(this).dialog("close"); }
                          }];
            }

            options = {
                autoOpen: false,
                width: 800,
                height: 450,
                modal: true,
                title: 'Pages:',
                buttons: listAllPagesButtons
           };

          myDialog.dialog(options);

          return myDialog;
        }

        function prepareListRevisionsDialog(myDialog, name, lang, showBackButton) {
        
        	theButtons = [
                          {
                                text: "Back",
                                click: function() { $(this).dialog("close"); }
                          },
                          {
                                text: "Close",
                                click: function() { $(this).dialog("close"); $('#listAllPagesDialog').dialog('close'); }
                          }
                      ];
                      
			if (!showBackButton) {
			
        	theButtons = [
                          {
                                text: "Close",
                                click: function() { $(this).dialog("close"); $('#listAllPagesDialog').dialog('close'); }
                          }
                      ];
			}                      
            

            options = {
                autoOpen: false,
                width: 800,
                height: 450,
                modal: true,
                title: 'Revisions for ' + name + ' in ' + lang,
                buttons: theButtons
           };

          myDialog.dialog(options);

          return myDialog;
        }
        
        function prepareListLastRevisionsDialog(myDialog, language) {
        
        	theButtons = [
                          {
                                text: "Close",
                                click: function() { $(this).dialog("close"); }
                          }
                      ];

            options = {
                autoOpen: false,
                width: 800,
                height: 450,
                modal: true,
                title: 'Latest revisions in ' + language,
                buttons: theButtons
           };

          myDialog.dialog(options);

          return myDialog;
        }
        
        
        function prepareFileUploadDialog(myDialog) {
        
            options = {
                autoOpen: false,
                width: 400,
                height: 300,
                modal: true,
                title: 'Uploading files...',
                buttons: [
                          {
                                text: "Close",
                                click: function() { $(this).dialog("close"); }
                          }
                      ]
           };

          myDialog.dialog(options);

          return myDialog;
        }        
        
        function showEditPageDialog(pageName, lang) {

            $.getJSON('/Page.get.mtw?name=' + pageName + '&lang=' + lang, function(data) {

                if (data.page.systemPage) {
                	$('.editPageTitleCell').hide();
                } else {
                	$('.editPageTitleCell').show();
                	$('#editPageTitle').val(data.page.title);
                }
                
                if (data.page.new) {
                	$('#editPageCommentCell').hide();
                } else {
                	$('#editPageCommentCell').show();
                	if (data.page.preview) {
                		$('#editPageComment').val(data.page.comment);
                	}
                }
                
                $('#editPageTextArea').val(data.page.body);
                $('#editPageName').val(data.page.name);
                $('#editPageLang').val(data.page.lang);

                myDialog = $('#editPageDialog');
                myDialog = prepareEditPageDialog(myDialog, 'Editing <i><font color="darkblue">' + pageName + "</font></i> in <i>" + data.page.language.name + "<i>...");
                myDialog.dialog('open');
            });
            
            return false;
        }
        
        function showFileListDialog() {

            $.getJSON('/File.listFiles.mtw', function(data) {

				$('#fileListTable').html('');
            
            	if (data.files.length == 0) {
            		$('#fileListTable').html('<tr><td align="center">No files uploaded yet!</td></tr>');
            	} else {
            		$.each(data.files, function(i,file) {
						$('#fileListTable').append('<tr><td>' + file + '</td></tr>');						            			
            		});
            	}

                myDialog = $('#fileListDialog');
                myDialog = prepareFileListDialog(myDialog);
                myDialog.dialog('open');
            });
            
            return false;
        }        

        function showShowPageDialog(pageName, lang, revision) {

            $.getJSON('/Page.get.mtw?name=' + pageName + '&lang=' + lang + '&revision=' + revision, function(data) {
            
                if (data.page.systemPage) {
                    $('.showPageTitleCell').hide();
                } else {
                    $('.showPageTitleCell').show();
                    $('#showPageTitle').val(data.page.title);
                }
                $('#showPageTextArea').val(data.page.body);

                theTitle = 'Showing <i><font color="darkblue">' + pageName + "</font></i> in <i>" + data.page.language.name + "<i>...";
                if (revision > 0) {
                    theTitle += ' (Revision #' + revision + ')';
                }

                myDialog = $('#showPageDialog');
                myDialog = prepareShowPageDialog(myDialog, theTitle);
                myDialog.dialog('open');
            });
            
            return false;
        }

        
        function showEditPreviewDialog(pageName, lang) {

            $.getJSON('/Page.getPreview.mtw?name=' + pageName + '&lang=' + lang, function(data) {

            	if (data.page.systemPage) {
                	$('.editPageTitleCell').hide();
                } else {
                	$('.editPageTitleCell').show();
                	$('#editPageTitle').val(data.page.title);
                }
                
                if (data.page.new) {
                	$('#editPageCommentCell').hide();
                } else {
                	$('#editPageCommentCell').show();
                	if (data.page.preview) {
                		$('#editPageComment').val(data.page.comment);
                	}
                }
                
                
                $('#editPageTextArea').val(data.page.body);
                $('#editPageName').val(data.page.name);
                $('#editPageLang').val(data.page.lang);

                myDialog = $('#editPageDialog');
                myDialog = prepareEditPageDialog(myDialog, 'Editing <i><font color="darkblue">' + pageName + "</font></i> in <i>" + data.page.language.name + "<i>...");
                myDialog.dialog('open');
            });
            
            return false;
        }
        
        
       	function showEditPreviewNewPageDialog(pageName, lang) {

            $.getJSON('/Page.getPreview.mtw?name=' + pageName + '&lang=' + lang, function(data) {
            
           		$('#createNewPageName').val(data.page.name);
        		$('#createNewPageTitle').val(data.page.title);
        		$('#createNewPageLanguage').val(data.page.languageId);
        		$('#createNewPageTextArea').val(data.page.body);
        		$('#createNewPageNameError').text('');
        		$('#createNewPageTitleError').text('');
        		$('#createNewPageLanguageError').text('');
        		$('#createNewPageBodyError').text('');
            
				showCreateNewPageDialog();

				$('#createPageLanguageCell').hide();
            });
            
            return false;
        }
        
        function showListAllPagesDialog(isAdmin) {

            $.getJSON('/Page.list.mtw', function(data) {

                tableData = '';
                tableData += '<tr>';
                if (isAdmin) tableData += '<th>&nbsp;</th>';
                tableData += '<th>Name</th>';
                tableData += '<th>Language</th>';
                tableData += '<th>Created By</th>';
                tableData += '<th>Modified By</th>';
                tableData += '<th>&nbsp;</th>';
                tableData += '<th>&nbsp;</th>';
                tableData += '<th>&nbsp;</th>';
                tableData += '</tr>';

                $.each(data.pages, function(i,page) {
                
                	pageName = page.name;

                    modifiedBy = '';
                    if (page.modifiedById > 0) {
                        modifiedBy = page.modifiedBy.username;
                    }

                    if (page.systemPage == true) {
                        pageName = '*' + pageName;
                    }

                    if (page.frontPage == true) {
                        pageName = '[' + pageName + ']';
                    }
                    
                    modifiedOnTitle = '';
                    if (page.formattedModifiedOn != null) {
                    	modifiedOnTitle = ' title="' + page.formattedModifiedOn + '"';
                    }
                    
                    createdOnTitle = '';
                    if (page.formattedCreatedOn != null) {
                    	createdOnTitle = ' title="' + page.formattedCreatedOn + '"';
                    }
                    
                    radioCell = '&nbsp;';
                    viewCell = '&nbsp;';
                    if (page.CSS == false && page.systemPage == false) {
                    	viewCell = '<a title="View Page" tabindex="-1" href="/Page.mtw?name=' + page.name + '&lang=' + page.lang + '"><img src="/images/preview.png" border="0" /></a> ';
                    	if (page.frontPage == false) {
                    		radioCell = '<input tabindex="-1" type="radio" name="pageId" id="pageId" value="' + page.id + '" />';
                    	}
                    }

                    viewRevisionsCell = '<a title="View Revisions" class="revisionLink" tabindex="-1" href="#" onclick="return showListRevisionsDialog(\'' + page.name + '\',\'' + page.lang + '\',\'' + page.language.name + '\', true);"><img src="/images/folder.png" height="24" height="20" border="0" /></a>';
                    
                    nameTitle = '';
                    if (page.title != null && page.title != '') {
                    	nameTitle = ' title="' + page.title + '"';
                    }

                    tableData += '<tr>';
                    if (isAdmin) tableData += '<td>' + radioCell + '</td>';
                    tableData += '<td' + nameTitle + '>' + pageName + '</td>';
                    tableData += '<td align="center">' + page.language.name + '</td>';
                    tableData += '<td align="center"' + createdOnTitle + '>' + page.createdBy.username + '</td>';
                    tableData += '<td align="center"' + modifiedOnTitle + '>' + modifiedBy + '</td>';
                    tableData += '<td align="center">' + viewCell + '</td>';
                    tableData += '<td align="center"><a tabindex="-1" title="View Html" href="#" onclick="return showShowPageDialog(\'' + page.name + '\',\'' + page.lang + '\', -1);"><img src="/images/view.png" border="0" /></a></td>';
                    tableData += '<td align="center">' + viewRevisionsCell + '</td>';
                    tableData += '</tr>';
                });

                $('#listAllPagesTable').html(tableData);

                myDialogDiv = $('#listAllPagesDialog');
                myDialog = prepareListAllPagesDialog(myDialogDiv, isAdmin);
                myDialog.dialog('open');
                $('.ui-dialog :button').blur();
             });
            
            return false;
        }

        function showListRevisionsDialog(name, lang, language, showBackButton) {

            $.getJSON('/Page.getRevisions.mtw?name=' + name + '&lang=' + lang, function(data) {

                tableData = '';
                tableData += '<tr>';
                tableData += '<th>Revision</th>';
                tableData += '<th>Author</th>';
                tableData += '<th>Date</th>';
                
                if (data.isSystemPage == false) {
                    tableData += '<th>&nbsp;</th>';
                }
                tableData += '<th>&nbsp;</th>';
                tableData += '</tr>';

                $.each(data.revisions, function(i,revision) {
                
                	titleForComment = '';
                	if (revision.comment != null && revision.comment != '') {
                		titleForComment = ' title="' + revision.comment + '"';
                	}

                    tableData += '<tr>';
                    tableData += '<td' + titleForComment + '>' + revision.revision + '</td>';
                    tableData += '<td align="center">' + revision.user.username + '</td>';
                    tableData += '<td align="center">' + revision.formattedCreatedOn + '</td>';

                    if (data.isSystemPage == false) {
                        tableData += '<td align="center"><a title="View Page" tabindex="-1" href="/Page.mtw?name=' + revision.name + '&lang=' + revision.lang + '&revision=' + revision.revision +'"><img src="/images/preview.png" border="0" /></a></td>';
                    }
                    
                    tableData += '<td align="center"><a tabindex="-1" title="View Html" href="#" onclick="return showShowPageDialog(\'' + revision.name + '\',\'' + revision.lang + '\',' + revision.revision + ');"><img src="/images/view.png" border="0" /></a></td>';

                    tableData += '</tr>';
                });

                $('#listRevisionsTable').html(tableData);
                myDialog = $('#listRevisionsDialog');
                myDialog = prepareListRevisionsDialog(myDialog, name, language, showBackButton);
                myDialog.dialog('open');
                $('.ui-dialog :button').blur();
             });
            
            return false;
        }
        
        function showListLastRevisionsDialog(lang, language, isLogged) {

            $.getJSON('/Page.getLastRevisions.mtw?lang=' + lang, function(data) {

                tableData = '';
                tableData += '<tr>';
                tableData += '<th>Page</th>';
                tableData += '<th>Revision</th>';
                tableData += '<th>Author</th>';
                tableData += '<th>Date</th>';
                tableData += '<th>Comment</th>';
                tableData += '<th>&nbsp;</th>';

                if (isLogged) {
                    tableData += '<th>&nbsp;</th>';
                }
                
                tableData += '</tr>';

                $.each(data.revisions, function(i,revision) {
                
                    tableData += '<tr>';
                    
                    pageName = revision.name;
                    
                    if (revision.frontPage) {
                    	pageName = '[' + pageName + ']';
                    } else if (revision.systemPage) {
                    	pageName = '*' + pageName;
                    }

                    nameTitle = '';
                    if (revision.title != null && revision.title != '') {
                    	nameTitle = ' title="' + revision.title + '"';
                    }
                    
                    tableData += '<td' + nameTitle + ' align="center">' + pageName + '</td>';
                    tableData += '<td align="center">' + revision.revision + '</td>';
                    tableData += '<td align="center">' + revision.user.username + '</td>';
                    tableData += '<td align="center">' + revision.formattedCreatedOn + '</td>';
                    tableData += '<td align="left">' + revision.comment + '</td>';

					if (!revision.systemPage) {
                    	tableData += '<td align="center"><a title="View Page" tabindex="-1" href="/Page.mtw?name=' + revision.name + '&lang=' + revision.lang + '&revision=' + revision.revision +'"><img src="/images/preview.png" border="0" /></a></td>';
                    } else {
                    	tableData += '<td>&nbsp;</td>';
                    }

                    if (isLogged) {
                        tableData += '<td align="center"><a tabindex="-1" title="View Html" href="#" onclick="return showShowPageDialog(\'' + revision.name + '\',\'' + revision.lang + '\',' + revision.revision + ');"><img src="/images/view.png" border="0" /></a></td>';
                    }
                    
                    tableData += '</tr>';
                });

                $('#listLastRevisionsTable').html(tableData);
                myDialog = $('#listLastRevisionsDialog');
                myDialog = prepareListLastRevisionsDialog(myDialog, language);
                myDialog.dialog('open');
                $('.ui-dialog :button').blur();
             });
            
            return false;
        }


       	function showCreateNewPageDialog() {

            $('#createNewPageFormName').val('ORM');
            $('#createNewPageFormLang').val('en');
            $('#createPageLanguageCell').show();

            myDialog = $('#createNewPageDialog');
            myDialog = prepareCreateNewPageDialog(myDialog);
            myDialog.dialog('open');
            
            return false;
        }
        
        function prepareCreateNewPageDialog(myDialog) {

            options = {
            	close: function() { clearCreateNewPageForm(); },
                autoOpen: false,
                width: 800,
                modal: true,
                title: "Create New Page:",
                buttons: [
                          {
                                text: "Create",
                                click: function() { $('#createNewPageForm').submit(); }
                          },
                          {
                              text: "Preview",
                              click: function() { $('#createNewPageFormPreview').val('true'); $('#createNewPageForm').submit(); }
                          },
                          {
                                text: "Cancel",
                                click: function() {  $(this).dialog("close"); }
                          }
                      ]
           };

          myDialog.dialog(options);

          return myDialog;
        }
        
        function showFileUploadDialog() {
  			
  			$('#uploadResults').html('');
        
        	myDialog = $('#fileUploadDialog');
        	myDialog = prepareFileUploadDialog(myDialog);
        	myDialog.dialog('open');
        }
        
    
        function showLoginDialog() {

            $('#loginFormName').val('ORM');
            $('#loginFormLang').val('en');

            myDialog = $('#loginDialog');
            myDialog = prepareLoginDialog(myDialog);
            myDialog.dialog('open');

            return false;
        }

        function showAddNewUserDialog(hideUsernameMessage) {

            myDialog = $('#addNewUserDialog');
            myDialog = prepareAddNewUserDialog(myDialog, hideUsernameMessage);
            myDialog.dialog('open');

            return false;
        }
        
        function clearLoginForm() {
        	$('#loginUsername').val('');
        	$('#loginPassword').val('');
        	$('#loginUsernameError').text('');
        	$('#loginPasswordError').text('');
        }

        function clearAddNewUserForm() {
        	$('#addNewUserUsername').val('');
        	$('#addNewUserPassword').val('');
        	$('#addNewUserPassconf').val('');
        	$('#addNewUserGroup').val('');
        	$('#usernameMessage').text('');
        	$('#addNewUserPasswordError').text('');
        	$('#addNewUserPassconfError').text('');
        	$('#addNewUserGroupError').text('');
        }
        
        function clearCreateNewPageForm() {
        	$('#createNewPageName').val('');
        	$('#createNewPageTitle').val('');
        	$('#createNewPageLanguage').val('');
        	$('#createNewPageTextArea').val('');
        	$('#createNewPageNameError').text('');
        	$('#createNewPageTitleError').text('');
        	$('#createNewPageLanguageError').text('');
        	$('#createNewPageBodyError').text('');
        }
        
      	function prepareLoginDialog(myDialog) {

            options = {
            	close: function() { clearLoginForm(); },
                autoOpen: false,
                width: 290,
                modal: true,
                title: "Login:",
                buttons: [
                          {
                                text: "Login",
                                click: function() { $('#loginForm').submit(); }
                          },
                          {
                                text: "Cancel",
                                click: function() {  $(this).dialog("close"); }
                          }
                      ]
           };

          myDialog.dialog(options);

          return myDialog;
        }

        function prepareAddNewUserDialog(myDialog, hideUsernameMessage) {

        	$('#usernameLoading').hide();
            if (hideUsernameMessage) $('#usernameMessage').text('');

            options = {
                close: function() { clearAddNewUserForm(); },
                autoOpen: false,
                width: 550,
                modal: true,
                title: "Add New User:",
                buttons: [
                          {
                                text: "Add",
                                click: function() { $('#addNewUserForm').submit(); }
                          },
                          {
                                text: "Cancel",
                                click: function() {  $(this).dialog("close"); }
                          }
                      ]
           };

          myDialog.dialog(options);

          return myDialog;
        }
        
      	function prepareConfirmDialog(myDialog) {

            options = {
                autoOpen: false,
                width: 300,
                modal: true,
                title: "Confirmation:",
                buttons: [
                          {
                                text: "Yes",
                                click: function() { $(this).dialog("close"); }
                          },
                          {
                                text: "No",
                                click: function() {  $(this).dialog("close"); }
                          }
                      ]
           };

          myDialog.dialog(options);

          return myDialog;
        }
        
         function showConfirmDialog() {

            myDialog = $('#confirmDialog');
            myDialog = prepareConfirmDialog(myDialog);
            myDialog.dialog('open');

            return false;
        }
        
        function usernameResult(response) {
        
                $('#usernameLoading').hide();
        
                var res = unescape(response);
        
                if (res == "error") {
        
                    $('#usernameMessage')
                            .html(
                                    '<font color="red"><b>Error!</b></font>');
                    $('#usernameMessage').fadeIn();
        
                } else if (res == "success") {
        
                    $('#usernameMessage').html(
                            '<img src="../../../images/chk.gif" />');
                    $('#usernameMessage').fadeIn();
        
                } else if (res == "already") {
        
                    $('#usernameMessage')
                            .html(
                                    '<font color="red"><b>Username already exists!</b></font>');
                    $('#usernameMessage').fadeIn();
                }
            }
        </script>
       	 	<!-- Google Analytics --> 
		


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3487700-4");
pageTracker._initData();
pageTracker._trackPageview();
</script>



       

</head>

<body class="composite">

<!--  For adding username -->
<div id="addNewUserDialog" style="display: none;">
        <form action="http://mentaframework.org/User.add.mtw" method="post" id="addNewUserForm">
            <table>
                <tr>
                    <td width="10%">
                        Username:
                    </td>
                    <td>
                        <input type="text" name="username" size="20" maxlength="30" id="addNewUserUsername" />
                        <span id="usernameLoading">
                            <img src="../../../images/loading.gif" />
                        </span>
                        <span id="usernameMessage">
                            
                        </span>
                    </td>
                </tr>
                <tr>
                    <td>
                        Password:
                    </td>
                    <td>
                        <input type="password" name="password" size="20" maxlength="20" id="addNewUserPassword" /> 
                        <span id="addNewUserPasswordError">
                            
                        </span>
                    </td>
                </tr>
                <tr>
                    <td>
                        Confirm:
                    </td>
                    <td>
                        <input type="password" name="passconf" size="20" maxlength="20" id="addNewUserPassconf" /> 
                        <span id="addNewUserPassconfError">
                            
                        </span>
                    </td>
                </tr>
                <tr>
                    <td>
                        Group:
                    </td>
                    <td>
                        <select name="groupId" id="addNewUserGroup">
<option value=""> - </option>
<option value="1">Admin</option>
<option value="2">Editor</option>
</select>

                        <span id="addNewUserGroupError">
                        
                        </span>
                    </td>
                </tr>
            </table>
        </form>
</div>

<!-- For Testing -->
<div id="dialog" title="Dialog Title" style="display: none;">I'm in a dialog</div>

<!-- Close Confirm -->
<div id="confirmDialog" style="display: none;">
	<span id="confirmMessage">The confirmation message goes here.</span>
</div>

<!-- For file upload -->
<div id="fileUploadDialog" style="display: none;">
<br/>
<input id="file_upload" name="file_upload" type="file" />
<table cellspacing="2" cellpadding="5" id="uploadResults" style="margin-top: 10px;">
</table>
</div>

<!-- For files listing -->
<div id="fileListDialog" style="display: none;">
<table cellspacing="2" cellpadding="5" id="fileListTable" style="margin-top: 10px;">
</table>
</div>

<!-- For Editing Pages -->
<div id="editPageDialog" style="display: none;">
<form id="editPageForm" action="http://mentaframework.org/Page.edit.mtw" method="post">
<input type="hidden" name="name" id ="editPageName" value="" />
<input type="hidden" name="lang" id="editPageLang" value="" />
<input type="hidden" name="isPreview" id="editPagePreview" value="false" />
<table border="0">
    <tr>
        <td>&nbsp;</td>
    </tr>
                <tr class="editPageTitleCell">
                    <td>
                        Title:&nbsp;&nbsp;&nbsp;&nbsp;
                        <input type="text" name="title" size="40" maxlength="100" id="editPageTitle" value="mentawai-orm-and-sql-builder" />
                        <span id="editPageTitleError">
                        
                        </span>
                    </td>
                </tr>
                <tr class="editPageTitleCell"><td colspan="2">&nbsp;</td></tr>
    <tr>
        <td><textarea name="body" style="width: 100%; height: 465px;" id="editPageTextArea"></textarea>
        <span id="editPageTextAreaError">
                        
                        </span>
        
        </td>
    </tr>
    
    <tr id="editPageCommentCell">
                    <td width="20%">
                        Edit comment: (<i>optional</i>) &nbsp;&nbsp;&nbsp;&nbsp;
                        <input type="text" name="comment" size="40" maxlength="100" id="editPageComment" />
                        <span id="editPageCommentError">
                        
                        </span>
                    </td>
                </tr>
    
</table>
</form>
</div>

<!-- For Showing Page Html -->
<div id="showPageDialog" style="display: none;">
<form id="showPageForm">
<table>
    <tr>
        <td>&nbsp;</td>
    </tr>
                <tr class="showPageTitleCell">
                    <td>
                        Title:
                    </td>
                    <td>
                        <input type="text" name="title" size="40" maxlength="100" id="showPageTitle" value="mentawai-orm-and-sql-builder" readonly="readonly" />
                    </td>
                </tr>
                <tr class="showPageTitleCell"><td>&nbsp;</td></tr>
    <tr>
        <td colspan="2">
        <textarea name="body" style="width: 100%; height: 465px;" id="showPageTextArea" readonly="readonly"></textarea>
        </td>
    </tr>
</table>
</form>
</div>


<!-- For Login -->
<div id="loginDialog" style="display: none;">
		<form action="http://mentaframework.org/Login.mtw" method="post" id="loginForm">
            <input type="hidden" name="name" value="" id="loginFormName" />
            <input type="hidden" name="lang" value="" id="loginFormLang" />
			<table>
				<tr>
					<td>
						Username:
					</td>
					<td>
						<input type="text" name="username" size="20" maxlength="20" id="loginUsername" />
						<span id="loginUsernameError">
						
						</span>
					</td>
				</tr>
				<tr>
					<td>
						Password:
					</td>
					<td>
						<input type="password" name="password" size="20" maxlength="20" id="loginPassword" />
						<span id="loginPasswordError"> 
						
						</span>
					</td>
				</tr>
			</table>
		</form>
</div>

<!-- For displaying all pages -->
<div id="listAllPagesDialog" style="display: none;">
    <form action="#" method="post" id="listAllPagesForm">
    <table id="listAllPagesTable">
    </table>
    </form>
</div>


<!-- For displaying revisions -->
<div id="listRevisionsDialog" style="display: none;">
    <table class="revisionsTable" id="listRevisionsTable">
    </table>
</div>

<!-- For displaying last revisions -->
<div id="listLastRevisionsDialog" style="display: none;">
    <table class="revisionsTable" id="listLastRevisionsTable">
    </table>
</div>


<!-- Create New Page -->
<div id="createNewPageDialog" style="display: none;">
		<form action="http://mentaframework.org/Page.add.mtw" method="post" id="createNewPageForm">
            <input type="hidden" name="name" value="" id="createNewPageFormName" />
            <input type="hidden" name="lang" value="" id="createNewPageFormLang" />
            <input type="hidden" name="isPreview" value="false" id="createNewPageFormPreview" />
			<table>
				<tr>
					<td>
						Name:
					</td>
					<td>
						<input type="text" name="newPage.name" size="40" maxlength="30" id="createNewPageName" />
						<span id="createNewPageNameError">
						
						</span>
					</td>
				</tr>
				<tr>
					<td>
						Title:
					</td>
					<td>
						<input type="text" name="newPage.title" size="40" maxlength="100" id="createNewPageTitle" />
						<span id="createNewPageTitleError">
						
						</span>
					</td>
				</tr>
				<tr id="createPageLanguageCell">
					<td>
						Language:
					</td>
					<td>
						<select name="newPage.languageId" id="createNewPageLanguage">
<option value=""> - </option>
<option value="1">English</option>
<option value="2">Portuguese</option>
</select>

						<span id="createNewPageLanguageError">
						
						</span>
					</td>
				</tr>
				<tr>
        			<td colspan="2">
        				<textarea name="newPage.body" style="width: 100%; height: 465px;" id="createNewPageTextArea"></textarea>
        				<span id="createNewPageBodyError">
						
						</span>
        			</td>
    			</tr>
			</table>
		</form>
</div>


<div>
<table border="0">
    <tr>
        <td>

        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../../index.html"><img src="../../../uploads/images/mentawai-logo-new.png" border="0" /></a>        
        
        
        </td>
        <td align="right" valign="bottom">
            
                <!-- a href="#" onclick="return showListLastRevisionsDialog('en', 'English', false);">Last Updates</a> | -->
                <a href="#" onclick="return showLoginDialog();">Login</a>
            
            
            &nbsp;
            
            <a href="mentawai-orm-and-sql-builder9ed2.html?lang=en"><img src="../../../uploads/images/flag_usa.gif" border="0" width="20" height="13" style="border: 3px solid #ccc; " /></a>
<a href="mentawai-orm-and-sql-builder923c.html?lang=pt"><img src="../../../uploads/images/flag_brazil.gif" border="0" width="20" height="13" style="border: 3px solid #fff; " /></a>

            &nbsp;&nbsp;&nbsp;
        </td>
    </tr>
</table>
</div>

<hr />

<div id="leftColumn">
<div id="navcolumn">
    <div>
    <h3>General Information</h3>
<ul>
<li><a href="../Intro" class="large">Overview</a></li>
<li><a href="../QuickStart" class="large">Quick Start</a></li>
<li><a href="../Downloads" class="large">Downloads</a></li>
<!-- li><a href="http://mentawai-forum.soliveirajr.com/forums/show/21.page" target="_blank" class="large">Discussion Forum</a></li -->
<li><a href="../../../api/index.html" target="_blank" class="large">API Documentation</a></li>
<li><a href="../Donations" class="large">Donations</a></li>
</ul>

<h3>Basics</h3>
<ul>
<li><a href="../Architecture" class="large">Big Picture</a></li>
<li><a href="../InOut" class="large">Action Input and Output</a></li>
<li><a href="../Contexts" class="large">Action Contexts</a></li>
<li><a href="../Consequences" class="large">Action Consequences</a></li>
<li><a href="../Filters" class="large">Filters</a></li>
</ul>

<h3>Features</h3>
<ul>
<li><a href="../Properties" class="large">Environment Properties</a></li>
<li><a href="../Authentication" class="large">Authentication</a></li>
<li><a href="../Authorization" class="large">Authorization</a></li>
<li><a href="../Validation" class="large">Validation</a></li>
<li><a href="../DynamicMessages" class="large">Dynamic Messages</a></li>
<li><a href="../IoC" class="large">Inversion of Control</a></li>
<li><a href="../I18N" class="large">Internationalization</a></li>
<li><a href="../DataLists" class="large">Data Lists</a></li>
<li><a href="../MentaTags" class="large">Menta Tags</a></li>
<li><a href="../CustomTags" class="large">Custom Tags</a></li>
<li><a href="../DB" class="large">DB Connection</a></li>
<li><span class="largeClicked">ORM and SQL builder</span></li>
<li><a href="../Email" class="large">Sending Email</a></li>
<li><a href="../FileUpload" class="large">File Upload</a></li>
<li><a href="../Ajax" class="large">Ajax</a></li>
<li><a href="../PrettyURL" class="large">Pretty URLs</a></li>
</ul>

<h3>Extra</h3>
<ul>
<li><a href="../RefApp" class="large">Reference Application</a></li>
<li><a href="../DebugMode" class="large">Debug Mode</a></li>
<li><a href="../Velocity" class="large">Velocity Integration</a></li>
<li><a href="../JRuby" class="large">JRuby Integration</a></li>
<li><a href="../Sticky" class="large">Stateful Actions</a></li>
<li><a href="../PojoActions" class="large">Pojo Actions</a></li>
<li><a href="../PaginatorTag" class="large">Paginator Tag</a></li>
<li><a href="../Hibernate" class="large">Hibernate Integration</a></li>
<li><a href="../JRebel" class="large">Jetty + JRebel + Maven</a></li>
</ul>

<h3>Links</h3>
<ul>
<li><a href="http://old.mentaframework.org/" target="_blank" class="large">Old Site</a></li>
<li><a href="http://forum.mentaframework.org/" target="_blank" class="large">Old Forum</a></li>
<li><a href="http://mentabean.soliveirajr.com/" target="_blank" class="large">MentaBean</a></li>
<li><a href="http://mentacontainer.soliveirajr.com/" target="_blank" class="large">MentaContainer</a></li>
<li><a href="http://kawai.soliveirajr.com/" target="_blank" class="large">Kawai Wiki</a></li>
</ul>

<h3>About</h3>
<ul>
<li><a href="../Subversion" class="large">Subversion</a></li>
<li><a href="../Team" class="large">Project Team</a></li>
<li><a href="../Maven" class="large">Maven</a></li>
<li><a href="http://www.gnu.org/copyleft/lesser.html" target="_blank" class="large">License (LGPL)</a></li>
</ul>
    </div>
<br />
</div>

</div>

<div id="bodyColumn">
    
    <h3>ORM and SQL Builder</h3>
<ul>
<p>
Mentawai is also an ORM and query builder framework that can help you work with the database. If you know SQL you can easily write Data Access Objects (DAOs) for you web application with Mentawai.
</p>
<p class="commands"><b>NOTE:</b> The ORM and SQL builder capabilities of Mentawai were extracted in a separate project called <a href="http://mentabean.soliveirajr.com/" target="_blank">MentaBean</a>, which remains seamlessly integrated with the framework.</p>
<p class="note">The bean or POJO (Plain Old Java Object):</p>
<pre class="brush: java; noBR: true;">
	public class User {

		public static enum Status {
			BASIC, PREMIUM, GOLD
		}

		private int id;
		private String username;
		private Date birthdate;
		private Status status = Status.BASIC;
		private boolean deleted;
		private Date insertTime;

		public User() {
		}

		public User(int id) {
			this.id = id;
		}

		// a bunch of getters and setters
	}
</pre>
<p class="note">The mapping in the application manager (as always done programmatically with no XML or annotations):</p>
<pre class="brush: java; noBR: true;">
// inside the application manager:

	@Override
	public void loadBeans() {

		bean(User.class, "Users") // table name is "Users"
			.pk("id", DBTypes.AUTOINCREMENT)
			.field("username", DBTypes.STRING)
			.field("birthdate", "bd", DBTypes.DATE) // note that the database column name is different
			.field("status", DBTypes.ENUMVALUE.from(User.Status.class))
			.field("deleted", DBTypes.BOOLEANINT)
			.field("insertTime", "insert_time", DBTypes.NOW_ON_INSERT_TIMESTAMP);

	}
</pre>
<p class="note">The DAO (Data Access Object):</p>
<pre class="brush: java; noBR: true;">
public class JdbcUserDAO implements UserDAO {

    private final BeanSession beanSession;

    public JdbcUserDAO(BeanSession beanSession) {
        this.beanSession = beanSession;
    }

    // data access will be implemented here
}
</pre>
<p class="note">Choosing the SQL dialect and the UserDAO implementation through IoC:</p>
<pre class="brush: java; noBR: true;">
// inside the application manager:

	@Override
	public void setupIoC() {
		
		ioc("beanSession", MySQLBeanSession.class);
		
		ioc("userDAO", JdbcUserDAO.class);
	}
</pre>
<p class="commands"><b>NOTE:</b> A BeanSession needs a database Connection, so don't forget to configure you connection handler as described in the <a href="../DB" class="large">DB Connection</a> section.</p>
<p class="note">Simple CRUD access with no SQL:</p>
<pre class="brush: java; noBR: true;">
			// INSERT:

			User u = new User();
			u.setUsername("saoj");
			u.setBirthdate("1983-01-20");
			u.setStatus(User.Status.GOLD);

			session.insert(u);

			int id = u.getId(); // should return the new ID in the database

			// SELECT:

			u = new User(1); // user with id = 1
			boolean loaded = session.load(u); // should return true

			// UPDATE:

			u.setUsername("soliveira");
			int modified = session.update(u); // should return 1

			// DELETE:

			boolean deleted = session.delete(u); // should return true


			// make sure the bean is deleted from the database...
			u = new User(1);
			loaded = session.load(u); // should return false
</pre>
<p class="note">Writing joins to load more than one bean at the same time:</p>
<p>Another bean:</p>
<pre class="brush: java; noBR: true;">
	public class Post {

		private int id;
		private int userId;
		private User user; // has an User (one-to-one relationship)
		private String title;
		private String body;
		private Date insertTime;

		public Post() {
		}

		public Post(int id) {
			this.id = id;
		}

		public Post(int userId, String title, String text) {
			this.userId = userId;
			this.title = title;
			this.body = text;
		}
		
		// setters and getters here...
	}
</pre>
<p>Map the new bean in the application manager:</p>
<pre class="brush: java; noBR: true;">
	@Override
	public void loadBeans() {

		bean(Post.class, "Posts") // table name is "Posts"
			.pk("id", DBTypes.AUTOINCREMENT)
			.field("userId", "user_id", DBTypes.INTEGER)
			.field("title", DBTypes.STRING)
			.field("body", DBTypes.STRING)
			.field("insertTime", "insert_time", DBTypes.NOW_ON_INSERT_TIMESTAMP);
	}
</pre>
<p>Now the JOIN query:</p>
<pre class="brush: java; noBR: true;">
			User u = new User(); // Note: You can also write other constructors for the User object
			u.setUsername("saoj");
			u.setBirthdate("1983-01-20");
			session.insert(u);

			int userId = u.getId(); // the unique ID created in the database for this user

			// Now insert a post for this user...
			Post p = new Post(u.getId(), "Test", "This is a test!");
			session.insert(p);

			int postId = p.getId();

			// Use JOIN to load all dependencies with a single query... (you know how to make a join, right?)

			p = new Post();

			StringBuilder query = new StringBuilder(256);
			query.append("select ");
			query.append(session.buildSelect(Post.class, "p"));
			query.append(", ");
			query.append(session.buildSelect(User.class, "u"));
			query.append(" from Posts p join Users u on p.user_id = u.id");
			query.append(" where p.id = ?");

			stmt = conn.prepareStatement(query.toString());
			stmt.setInt(1, postId);

			rset = stmt.executeQuery();

			if (rset.next()) {

				session.populateBean(rset, p, "p");

				u = new User();

				session.populateBean(rset, u, "u");

				p.setUser(u); // manual lazy loading (because you want control and no magic!)
			}

			rset.close();
			stmt.close();
</pre>
<p class="note">Much more:</p>
<p>MentaBean offers many neat features that you can check in the <a href="http://mentabean.soliveirajr.com/forums/show/10.page" target="_blank">recipes section</a> of its web site. For example, you can <a href="http://mentabean.soliveirajr.com/posts/list/24.page" target="_blank">load a list of beans</a>, <a href="http://mentabean.soliveirajr.com/posts/list/51.page" target="_blank">use reflection to map a bean automatically</a>, <a href="http://mentabean.soliveirajr.com/posts/list/47.page" target="_blank">take advantage of the three different kinds of updates</a>, and much more.</p>
</div>

<div class="clear">
<hr />
</div>
<br/><br/><br/>
<div id="footer">
<div><center>Copyright (c) 2011 - Powered by <a href="http://kawai.soliveirajr.com/" target="_blank"><b>Kawai</b></a></center></div>
<div class="clear">
<hr />
</div>
</div>

</body>

<!-- Mirrored from mentaframework.org/mtw/Page/ORM/mentawai-orm-and-sql-builder?lang=en by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 11 Jan 2022 15:48:48 GMT -->
</html>
